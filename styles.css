/* Reset + base */
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  background: #0e0f14; color: #e6e6e6; line-height: 1.5;
}

/* Header */
.site-header {
  display:flex; justify-content:space-between; align-items:center;
  padding:1rem; background:#16171d; border-bottom:1px solid #2a2b33;
}
.site-header h1 { font-size:1.2rem; }
nav { display:flex; gap:.5rem; }
.tab {
  background:#22242e; color:#e6e6e6; border:1px solid #2a2b33;
  padding:.5rem 1rem; border-radius:999px; cursor:pointer; transition:.15s ease;
}
.tab:hover { background:#2a2d3a; }
.tab:active { transform: translateY(1px); }
.tab.active { background:#3b3f52; }

/* Badge on Grove tab */
.badge {
  display:inline-block; min-width:1.25rem; padding:0 .35rem;
  margin-left:.4rem; font-size:.75rem; line-height:1.25rem; text-align:center;
  color:#0e0f14; background:#c9a806; border-radius:999px; font-weight:700;
}

/* Pulse highlight */
.tab.pulse {
  box-shadow: 0 0 0 0 rgba(201,168,6,.6);
  animation: pulse 1.5s ease-out 2;
}
@keyframes pulse {
  0% { box-shadow: 0 0 0 0 rgba(201,168,6,.6); }
  100%{ box-shadow: 0 0 0 18px rgba(201,168,6,0); }
}

/* Panels */
main { padding:1rem; max-width:900px; margin:auto; }
.panel { margin-top:1rem; }
.help { color:#aab0bb; font-size:.92rem; margin-top:.35rem; }

/* Stepper */
.stepper { display:flex; align-items:center; gap:.35rem; color:#9aa1ad; font-size:.9rem; }
.stepper .step.active { color:#e6e6e6; font-weight:600; }
.stepper .sep { opacity:.4; }

/* Nudge bar */
.nudge {
  margin-top:.5rem; padding:.5rem .7rem;
  background:#12141c; border:1px solid #2a2b33; border-radius:10px; color:#d9dce2;
}
.linky {
  background:transparent; border:none; color:#8aa0ff; text-decoration:underline; cursor:pointer;
  padding:0 .15rem;
}
.linky:hover { opacity:.85; }

/* Ask row */
.ask-row { display:grid; gap:.6rem; grid-template-columns: 1fr auto; align-items:start; }
textarea {
  width:100%; min-height:72px; padding:.6rem;
  background:#10121a; border:1px solid #2a2b33; border-radius:10px; color:#fff;
}
button {
  background:#2a2d3a; border:1px solid #2a2b33; color:#e6e6e6;
  padding:.55rem 1rem; border-radius:10px; cursor:pointer; transition:.15s ease;
}
button:hover { background:#3a3e52; }
button:active { transform: translateY(1px); }
button[disabled] { opacity:.6; cursor:not-allowed; }

/* Tombstone */
.tombstone {
  margin-top:1rem; padding:1rem; border-radius:18px;
  background:#14151c; border:1px solid #2a2b33; position:relative; overflow:hidden;
}
.grave-top { display:flex; align-items:center; gap:.6rem; margin-bottom:.5rem; }
.grave-icon { font-size:1.4rem; filter: drop-shadow(0 0 6px rgba(255,255,255,.06)); }
.grave-inscription { font-variant:small-caps; letter-spacing:.08em; color:#bfbfbf; text-shadow:0 1px 0 rgba(0,0,0,.4); }
.tombstone p { margin-top:.4rem; color:#d7d7d7; }

/* subtle candle glow */
.tombstone::after {
  content:""; position:absolute; top:-30px; left:50%; transform:translateX(-50%);
  width:200px; height:60px; border-radius:50%;
  background: radial-gradient(ellipse at center, rgba(255,240,200,.15), transparent 60%);
  animation: flicker 3.8s ease-in-out infinite; pointer-events:none;
}
@keyframes flicker { 0%,100%{opacity:.35; transform:translateX(-50%) scale(1);} 50%{opacity:.15; transform:translateX(-50%) scale(1.05);} }

/* Skeleton */
.skeleton { margin-top:.25rem; }
.shimmer { height:12px; border-radius:6px; background:#1a1c25; overflow:hidden; position:relative; }
.shimmer::after {
  content:""; position:absolute; inset:0;
  background:linear-gradient(90deg, transparent, rgba(255,255,255,.06), transparent);
  animation: shimmer 1200ms infinite;
}
.shimmer.line { margin-top:.4rem; }
.shimmer.line.short { width:60%; }
@keyframes shimmer { 0%{transform:translateX(-100%);} 100%{transform:translateX(100%);} }

/* Error box */
.error {
  margin-top:.5rem; background:#2b1d1f; color:#ffdede;
  border:1px solid #e5534b; border-radius:10px; padding:.55rem .7rem;
}

/* Classification */
.classify { margin-top:1rem; }
.classify-row { display:flex; gap:.5rem; margin:.35rem 0 .6rem; }
.classify button[data-class="green"] { background:#234f2e; border-color:#3fb950; color:#dfffe9; }
.classify button[data-class="green"].active { background:#2ea043; border-color:#2ea043; }
.classify button[data-class="yellow"] { background:#4f4a23; border-color:#c9a806; color:#fff7d1; }
.classify button[data-class="yellow"].active { background:#c9a806; border-color:#c9a806; color:#222; }
.classify button[data-class="red"] { background:#4f2323; border-color:#e5534b; color:#ffe1df; }
.classify button[data-class="red"].active { background:#e5534b; border-color:#e5534b; color:#fff; }

/* Action bar */
.action-bar { display:flex; align-items:center; gap:.5rem; margin-top:.6rem; position:sticky; bottom:.5rem; }
.chip { background:#1b1d26; border:1px solid #2a2b33; padding:.25rem .5rem; border-radius:999px; font-size:.85rem; color:#cfd2d8; }

/* Grove */
.grove-toolbar { display:flex; align-items:center; gap:.5rem; margin-top:.25rem; }
.grove-toolbar .spacer { flex:1; }
.ghost-btn { background:#22242e; border:1px solid #2a2b33; padding:.35rem .7rem; border-radius:8px; }
.filters { display:flex; gap:.35rem; }
.filter-btn { background:#1b1c24; border:1px solid #2a2b33; padding:.35rem .7rem; border-radius:8px; }
.filter-btn[aria-pressed="true"] { outline:2px solid #8aa0ff; }

.grove-grid {
  list-style:none; margin-top:1rem;
  display:grid; gap:.75rem; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
}
.seed {
  background:#13141a; border:1px solid #2a2b33; border-radius:14px; padding:.85rem 1rem;
  position:relative; overflow:hidden;
}
.seed::before { content:''; position:absolute; left:0; top:0; bottom:0; width:6px; }
.seed-green::before  { background:#3fb950; }
.seed-yellow::before { background:#c9a806; }
.seed-red::before    { background:#e5534b; }
.seed-head { display:flex; align-items:center; gap:.6rem; margin-bottom:.35rem; }
.seed-emoji { font-size:1.2rem; }
.seed-title { font-weight:600; color:#dcdcdc; }
.seed p { font-size:.92rem; color:#bfbfbf; }
.seed small { display:block; margin-top:.45rem; color:#8d8d8d; }

/* Toast */
.toast {
  position:fixed; left:50%; bottom:1rem; transform:translateX(-50%) translateY(20px);
  background:#0f1117; border:1px solid #2a2b33; color:#e6e6e6;
  padding:.55rem .8rem; border-radius:10px; opacity:0; pointer-events:none;
  transition: transform .2s ease, opacity .2s ease;
}
.toast.show { opacity:1; transform:translateX(-50%) translateY(0); }

/* A11y */
.visually-hidden {
  position:absolute !important; height:1px; width:1px; overflow:hidden;
  clip: rect(1px,1px,1px,1px); white-space:nowrap;
}

/* Mobile tweaks */
@media (max-width: 640px) {
  .ask-row { grid-template-columns: 1fr; }
  button, .ghost-btn { padding:.6rem .85rem; }
}
/* Graveyard scene */
.graveyard-wrap { position:relative; margin-top: .75rem; border-radius:18px; overflow:hidden; border:1px solid #2a2b33; background: #0c0f16; }
.grove-canvas { display:block; width:100%; height:62vh; min-height:420px; background: radial-gradient(ellipse at 50% 10%, #141a24, #0c0f16 65%); }

/* Hills (parallax layers) */
.hill { position:absolute; left:0; right:0; height:28%; background-repeat:repeat-x; background-size: 1200px 100%; opacity:.35; filter: blur(0.4px); }
.layer-1 { bottom:0;   background-image: linear-gradient(#131722, #0e1119); clip-path: polygon(0 45%, 20% 35%, 40% 50%, 60% 30%, 80% 44%, 100% 36%, 100% 100%, 0 100%); }
.layer-2 { bottom:10%; background-image: linear-gradient(#151927, #0f1320); clip-path: polygon(0 55%, 18% 42%, 38% 58%, 58% 40%, 78% 54%, 100% 46%, 100% 100%, 0 100%); opacity:.25; }
.layer-3 { bottom:20%; background-image: linear-gradient(#171c2b, #101425); clip-path: polygon(0 65%, 20% 55%, 40% 68%, 60% 50%, 80% 64%, 100% 56%, 100% 100%, 0 100%); opacity:.18; }

/* Moon & fog */
.moon { position:absolute; width:90px; height:90px; top:6%; left:8%; border-radius:50%;
  background: radial-gradient(circle at 35% 35%, #fff, #cfd8ff 40%, #a1a8c6 60%, transparent 70%);
  box-shadow: 0 0 60px rgba(180,190,255,.15);
}
.fog { position:absolute; left:0; right:0; bottom:12%; height:120px; background:
  radial-gradient(ellipse at 20% 50%, rgba(255,255,255,.03), transparent 60%),
  radial-gradient(ellipse at 60% 50%, rgba(255,255,255,.03), transparent 60%),
  radial-gradient(ellipse at 85% 50%, rgba(255,255,255,.02), transparent 60%);
  filter: blur(6px); mix-blend-mode: screen; pointer-events:none;
}
.fog-a { animation: drift 26s linear infinite; }
.fog-b { bottom:6%; opacity:.7; animation: drift 34s linear infinite reverse; }
@keyframes drift { 0% { transform: translateX(-4%); } 100% { transform: translateX(4%); } }

/* Stones hover/selection */
.stone { cursor:pointer; }
.stone:hover .stone-body { filter:url(#noise); }
.stone .stone-body { transition: transform .2s ease; }
.stone:hover .stone-body { transform: translateY(-2px); }

/* Engraved text */
.stone text { font-family: ui-serif, Georgia, serif; font-variant: small-caps; fill:#e6e6e6; filter:url(#engrave); }

/* Growth layers */
.growth-green { filter: drop-shadow(0 0 6px rgba(147, 244, 183, .24)); }
.growth-yellow { filter: drop-shadow(0 0 6px rgba(255, 232, 154, .22)); }
.growth-red { filter: drop-shadow(0 0 6px rgba(229, 83, 75, .22)); }

/* Utility hidden list (kept for SR/debug) */
.visually-hidden {
  position:absolute !important; height:1px; width:1px; overflow:hidden;
  clip: rect(1px,1px,1px,1px); white-space:nowrap;
}
.grove-frame {
  margin-top: 0.75rem;
  background: #0f1117;
  border: 1px solid #2a2b33;
  border-radius: 14px;
  overflow: hidden;
}

#groveCanvas { width: 100%; height: clamp(360px, 60vh, 720px); display: block; }

.grove-toolbar {
  display: flex;
  gap: .5rem;
  margin: .5rem 0;
}
.grove-toolbar .filter-btn {
  background: #22242e;
  border: 1px solid #2a2b33;
  padding: .35rem .7rem;
  border-radius: 999px;
  font-size: .9rem;
  cursor: pointer;
}
.grove-toolbar .filter-btn[aria-pressed="true"] { background: #3b3f52; }

.hint { color:#9aa0aa; margin-top:.5rem; font-size:.9rem; }

/* stone hover + labels */
.stone:hover { filter: brightness(1.05); }
/* Make labels readable on dark bg */
.stone-label {
  font-size: 12px;
  fill: rgba(255,255,255,.85);
}
.stone-halo.green  { stroke: #7bd389; }
.stone-halo.yellow { stroke: #e1d97a; }
.stone-halo.red    { stroke: #ee8a8a; }

#classifyBox[hidden]{display:none;}
#classifyBox{opacity:0;transition:opacity .25s ease;}
#classifyBox:not([hidden]){opacity:1;}
