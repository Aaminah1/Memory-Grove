<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Memory Grove ‚Äî App</title>
  <!-- Your existing app CSS files -->
  <link rel="stylesheet" href="css/styles.css" />
  <link rel="stylesheet" href="css/modal-styles.css" />
  
</head>
<body>
<header class="site-header">
  <h1 class="brand">
    <a href="index.html"
       class="brand-link"
       data-label="MEMORY GROVE"
       aria-label="Go to Memory Grove home">
      Memory Grove
    </a>
  </h1>
<nav class="site-nav">
  <button
    id="tab-ask"
    class="tab ghost is-active"
    aria-controls="ghostSection"
    data-label="Ask the Ghost">
    Ask the Ghost
  </button>

  <button
    id="tab-grove"
    class="tab primary"
    aria-controls="groveSection">
    Your Grove <span id="groveBadge" class="badge" aria-hidden="true" hidden>0</span>
  </button>
</nav>
</header>

  <main>
<div class="stepper" aria-label="Process steps">
  <span class="step step-ask active" data-step="1">Send a question</span>
  <span class="sep">‚ü∂</span>
  <span class="step step-read" data-step="2">Witness the ghost‚Äôs memory</span>
  <span class="sep">‚ü∂</span>
  <span class="step step-classify" data-step="3">Judge its truth</span>
  <span class="sep">‚ü∂</span>
  <span class="step step-plant" data-step="4">Plant your seed</span>
</div>

    <!-- Nudge -->
    <div id="groveNudge" class="nudge" hidden>
      Seed planted. View it in
      <button id="gotoGrove" class="linky" type="button" aria-controls="groveSection">Your Grove</button>.
    </div>

    <!-- ASK PANEL -->
    <section id="ghostSection" class="panel">
      <h2>Encounter the Ghost</h2>
      <p class="metaphor-text metaphor-text--ghost"> What you offer becomes a shape it tries to recognise. </p>

      <form id="askForm" class="ask-row" aria-describedby="askHelp">
        <textarea id="question" placeholder="Ask a culturally grounded question‚Ä¶" required minlength="3"></textarea>
        <button id="askBtn" type="submit" disabled>Ask</button>
      </form>
      <!-- Right-side app ghost -->
<div id="appGhost" class="app-ghost" >
  <div class="sprite idle-bob idle-tilt">
    <!-- Minimal inline SVG ghost body (same face hooks: .eye, .mouth) -->
    <svg viewBox="0 0 160 200" class="sprite-svg" role="img" aria-label="Listening ghost">
      <defs>
        <filter id="appGhostShadow" x="-20%" y="-20%" width="140%" height="140%">
          <feDropShadow dx="0" dy="10" stdDeviation="8" flood-opacity="0.35"/>
        </filter>
      </defs>
      <!-- body -->
      <path d="M80 18c-28 0-50 22-50 50v70c0 0 10 14 20 0 10-14 10 14 24 0 10-10 14 18 26 0 10-14 16 16 28 0V68c0-28-22-50-48-50z"
            fill="#e7ebf4" filter="url(#appGhostShadow)"/>
      <!-- eyes -->
      <ellipse class="eye" cx="62" cy="82" rx="6.2" ry="7.2" fill="#0b0d13"/>
      <ellipse class="eye" cx="98" cy="82" rx="6.2" ry="7.2" fill="#0b0d13"/>
      <!-- mouth -->
      <rect class="mouth" x="70" y="102" width="20" height="7" rx="3.5" fill="#0b0d13"/>
    </svg>
  </div>

  <!-- speech bubble -->
  <div id="appGhostBubble" class="mg-bubble" role="status" aria-live="polite"></div>
</div>

        <div class="help">
    <span id="qCount">0/240</span> characters
  </div>
      <p id="askHelp"  class="help">
  Ask with care about what was lived, not just told.  
  Stories, memories, or meanings the system may have forgotten.      </p>

      <!-- Reply ‚Äútombstone‚Äù -->
      <div id="tombstoneSection" class="tombstone" hidden>
        <div class="grave-top">
          <div class="grave-icon" aria-hidden="true">ü™¶</div>
          <div class="grave-inscription">Ghost Memory</div>
        </div>

        <!-- loading skeleton -->
        <div id="skeleton" class="skeleton" hidden>
          <div class="shimmer line"></div>
          <div class="shimmer line"></div>
          <div class="shimmer line short"></div>
        </div>

        <!-- errors -->
        <div id="errorBox" class="error" hidden role="alert"></div>

        <p id="tombstoneText" aria-live="polite"></p>

        <!-- classification -->
        <div class="classify" id="classifyBox" hidden>
          <p class="help">Choose how it feels:</p>
          <div class="classify-row" role="group" aria-label="Classify the ghost reply">
            <button type="button" data-class="green"  title="Resonates (agreement)">Resonates</button>
            <button type="button" data-class="yellow" title="Partial / nuance">Partially right</button>
            <button type="button" data-class="red"    title="Counter-memory / reject">Wrong / harmful</button>
          </div>

          <label class="visually-hidden" for="note">Your note</label>
          <textarea id="note" placeholder="Add a correction, nuance, or counter-memory (optional)"></textarea>

          <div class="action-bar">
            <span class="chip" id="selectedChip" hidden>‚Äî</span>
            <button id="plantBtn" type="button" disabled>Plant Seed</button>
          </div>
        </div>
      </div>
    </section>

    <!-- GROVE PANEL -->
   <section id="groveSection" class="panel" hidden>
  <header class="grove-header">
    <div class="grove-title-block">
      <h2>Your Grove</h2>
      <p class="metaphor-text metaphor-text--grove">
        Each seed marks resonance, correction, or refusal. Over time, these small choices
        become a living memory the ghost cannot hold.
      </p>
    </div>

    <div class="grove-tools">
      <button id="exportBtn" type="button">Export</button>
      <button id="importBtn" type="button">Import</button>
      <input id="importFile" type="file" accept="application/json" hidden />
    </div>
  </header>



      <div class="grove-frame">
        <div class="grove-fog"></div>
        <div class="grove-dust"></div>
        <svg id="groveCanvas" viewBox="0 0 1200 700" preserveAspectRatio="xMidYMid meet">
          <defs>
            <linearGradient id="graveGrad" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#1a1b22"/>
              <stop offset="100%" stop-color="#0f1015"/>
            </linearGradient>
          </defs>

          <rect id="bgRect" x="0" y="0" width="1200" height="700" fill="url(#graveGrad)"/>

          <!-- Stones inserted by JS -->
          <g id="stonesLayer"></g>
        </svg>
      </div>

      <p class="hint">Tip: click a stone to open it. Double-click (or press ‚Äún‚Äù) to add notes for that label.</p>

    </section>
  </main>

  <footer class="site-footer">
    <small>Prototype for reflection. Seeds are stored locally on this device.</small>
  </footer>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- Stone modal -->
  <div id="stoneModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="stoneTitle">
    <div class="modal-backdrop" data-close></div>
    <div class="modal-card" role="document">
      <header class="modal-header">
        <h3 id="stoneTitle">Ghost Memory</h3>
        <button class="modal-close" type="button" title="Close" data-close>&times;</button>
      </header>
      <div class="modal-body">
        <p id="stoneGhost" class="modal-ghost"></p>

        <div class="modal-classify">
          <label class="block">How does it feel?</label>
          <div class="modal-choices" role="group" aria-label="Choose a classification">
            <button type="button" class="mc" data-class="green">üå± Resonates</button>
            <button type="button" class="mc" data-class="yellow">üåø Partially right</button>
            <button type="button" class="mc" data-class="red">ü™¶ Wrong / harmful</button>
          </div>
        </div>

     <label for="stoneNote" class="block">Your note (optional)</label>
<textarea id="stoneNote" class="modal-note" placeholder="Add nuance or a correction‚Ä¶"></textarea>

<div id="stoneHistory" class="stone-history"></div>
</div>
<footer class="modal-footer">
        <button type="button" id="stoneDelete" class="danger">Ease Tombstone</button>
        <div class="spacer"></div>
        <button type="button" class="secondary" data-close>Cancel</button>
        <button type="button" id="stoneSave" class="primary">Save</button>
      </footer>
    </div>
  </div>

  <!-- Notes modal (gets created dynamically by JS if missing, but having it is fine) -->
  <div id="notesModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal__backdrop" data-close></div>
    <div class="modal__dialog" role="document">
      <header class="modal__header">
        <h3 id="notesTitle">Notes</h3>
        <button class="modal-close" type="button" aria-label="Close" data-close>‚úï</button>
      </header>
      <div class="modal__body">
        <ul id="notesList" class="notes-list"></ul>
        <label class="visually-hidden" for="notesInput">Add a note</label>
        <textarea id="notesInput" placeholder="Write a reply‚Ä¶"></textarea>
      </div>
      <footer class="modal__footer">
        <div class="spacer"></div>
        <button id="notesSave" class="btn-primary" type="button">Post</button>
      </footer>
    </div>
  </div>

  <!-- Your app logic -->
  <script src="js/app.js"></script>
  <script src="js/ghost.js"></script> 
  <script src="js/ghost-app.js"></script>
</body>
</html>
