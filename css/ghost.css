/* ----- ghost container under the title ----- */

/* ----- ghost container under the title ----- */
#ghost{
position: absolute;
  left: 50%;
  top: clamp(110px, 30vh, 280px);

  /* base centering + JS-driven offsets */
  --ox: -50%;        /* keep horizontal centering */
  --tx: 0px;         /* JS updates these offsets */
  --ty: 0px;
  transform: translateX(var(--ox)) translate(var(--tx), var(--ty));

  color: #e7ebf4;
  opacity: 0;
  transition:
    opacity 700ms ease,
    transform 900ms cubic-bezier(.2,.9,.1,1);
  pointer-events: none;
  z-index: 9999;
}
#ghost.on{ opacity:1; }

/* When roaming after speaking */
#ghost.wander{
  opacity: 0.65;              /* a bit ghostier */
  transition:
    opacity 800ms ease,
    transform 1600ms cubic-bezier(.23,1,.32,1);  /* smoother long moves */
}


/* Sprite stays hidden until .ready — ONLY BREATHE LIVES HERE */
#ghost .sprite{
  position: relative;
  width: clamp(160px, 22vw, 300px);
  height: auto;
  opacity: 0;
  transition: opacity 380ms ease;
  animation: ghostBreathe 5.2s ease-in-out infinite; /* scaleY only */
  filter: drop-shadow(0 10px 28px rgba(255,255,255,.10));
  z-index: 1;
}
#ghost.ready .sprite { opacity: 1; }
/* only the bob-wrapper translates on Y — keeps centering pristine */
#ghost .idle-bob{
  animation: ghostBob var(--bobDur) cubic-bezier(.22,.61,.33,1) infinite;
  will-change: transform;
}

/* bigger swing; clean midpoint at 50% for a gentle “hover” feel */
@keyframes ghostBob{
  0%   { transform: translateY(calc(var(--bobAmp) * -0.00)); }
  25%  { transform: translateY(calc(var(--bobAmp) * -0.55)); }
  50%  { transform: translateY(calc(var(--bobAmp) * -1.00)); }
  75%  { transform: translateY(calc(var(--bobAmp) * -0.55)); }
  100% { transform: translateY(calc(var(--bobAmp) * -0.00)); }
}

/* Optional: add a *tiny* rotation to sell the float more */
#ghost .idle-tilt{
  animation: ghostTilt 9.8s ease-in-out infinite;
}
@keyframes ghostTilt{
  0%,100%{ transform: rotate(0deg) }
  50%    { transform: rotate(-1.8deg) }
}


/* ===== COLOR-GLITCH LINES & RGB SLICE ===== */

/* scanline pass – denser + brighter sweep */
#ghost .sprite::after{
  content:"";
  position:absolute; inset:-8%;
  pointer-events:none;
  mix-blend-mode:screen;
  opacity:0;
  background:
    repeating-linear-gradient(
      to bottom,
      rgba(255,  40,150, .00) 0   4px,
      rgba(255,  40,150, .16) 4px 5px,
      rgba( 30, 220,255, .00) 5px 10px
    );
  filter: blur(.35px) saturate(1.35);
}
/* Punchier colour-glitch sweep (keeps your existing toggles) */
/* punchier colour glitch */
#ghost.glitch .sprite::after{
  opacity:.95;
  animation: ghostScan 180ms linear 1;
}
#ghost.glitch .sprite::before{
  opacity:1;
  animation: ghostSlice 150ms steps(2,end) 1;
}

/* stronger variant every few cycles */
#ghost.glitch-strong .sprite::before{
  filter:
    drop-shadow( 3px -2px rgba(255, 32, 96, .55))
    drop-shadow(-3px  2px rgba( 32,210,255, .55))
    drop-shadow( 0px  0px rgba(  0,255,140, .45));
}
#ghost.glitch-strong{
  animation: hueRoll 260ms steps(2,end) 1;   /* quick colour pop */
  filter: saturate(1.25) contrast(1.08);
}
@keyframes hueRoll{
  0%  { filter: hue-rotate(0deg)   saturate(1.25) contrast(1.08); }
  50% { filter: hue-rotate(24deg)  saturate(1.35) contrast(1.10); }
  100%{ filter: hue-rotate(0deg)   saturate(1.25) contrast(1.08); }
}

@keyframes ghostSlice{
  0%  { transform: translate(1.6px,-1.2px) skewX(1.2deg); }
  50% { transform: translate(-1.6px,1.2px) skewX(-1.2deg); }
  100%{ transform: translate(0,0) }
}

/* Respect reduced motion */
@media (prefers-reduced-motion: reduce){
  #ghost .idle-bob, #ghost .idle-tilt { animation: none; }
}
/* ————— ELECTRIC INTRO OVERLAY ————— */
#ghost .electric-intro{
  position:absolute; left:50%; top:50%;
  transform:translate(-50%, -50%);
  width: min(34vw, 420px);
  height: min(34vw, 420px);
  pointer-events:none;
  z-index: 40;                  /* above sprite and speech bubble */
  mix-blend-mode: screen;       /* pops on dark bg */
  filter: drop-shadow(0 0 20px rgba(120,200,255,.35));
}

/* subtle glow on the ghost body while charging */
#ghost.charging .sprite{
  filter:
    drop-shadow(0 0 24px rgba(120,200,255,.35))
    drop-shadow(0 0 40px rgba(120,200,255,.20));
}

/* waveform dash animate */
@keyframes dashFlow {
  0%   { stroke-dashoffset: 0; }
  100% { stroke-dashoffset: -600; }
}

/* bolt flicker scale/jitter */
@keyframes boltPulse {
  0%, 100% { opacity: .85; transform: translate(-50%, -50%) scale(1); }
  50%      { opacity: 1;    transform: translate(-50%, -50%) scale(1.03); }
}

/* post-birth settle shimmer */
@keyframes settleGlow {
  0% { filter: drop-shadow(0 0 34px rgba(120,200,255,.35)); }
  100%{ filter: drop-shadow(0 0 10px rgba(120,200,255,.12)); }
}




@keyframes ghostBob   { 0%,100%{ transform: translateY(0) } 50%{ transform: translateY(-7px) } }
@keyframes ghostBreathe{
  0%,100%{ transform: scaleY(1) }
  50%{ transform: scaleY(0.985) }
}

/* both faces live in the same spot; we just fade between them */
#ghost .face { animation: faceDrift 7.2s ease-in-out infinite; }
@keyframes faceDrift { 0%,100% { transform: translateX(0) } 50% { transform: translateX(1.4px) } }

#ghost .face-evil { opacity: 0; }
#ghost.evil .face-normal { opacity: 0; }
#ghost.evil .face-evil   { opacity: 1; }

/* blink (subtle/desynced) */
#ghost .eye{
  transform-origin:center; transform-box: fill-box;
  /* default faster rhythm; JS will randomize per-eye */
  animation: eyeBlink var(--blinkDur, 4.2s) steps(1,end) infinite;
}
#ghost.blink-now .eye {
  transform: scaleY(0.05);
}
#ghost .eye:nth-of-type(2){
  /* desync the second eye slightly */
  animation-delay: var(--blinkDelay, 1.0s);
}

/* base single-blink pattern */
@keyframes eyeBlink{
  0%, 90%, 100% { transform: scaleY(1) }
  91%           { transform: scaleY(0.12) }
  92%           { transform: scaleY(1) }
}
#ghost.blink-now .eye{
  animation: blinkNow 120ms steps(1,end) 1;
}
@keyframes blinkNow{
  0%   { transform: scaleY(1) }
  50%  { transform: scaleY(0.10) }
  100% { transform: scaleY(1) }
}

/* optional “double-blink” pattern for variety */
#ghost.double-blink .eye{
  animation: blinkDouble 240ms steps(1,end) 1;
}
@keyframes blinkDouble{
  0%   { transform: scaleY(1) }
  15%  { transform: scaleY(0.12) }
  30%  { transform: scaleY(1) }
  60%  { transform: scaleY(0.12) }
  85%  { transform: scaleY(1) }
  100% { transform: scaleY(1) }
}
/* talk while speaking */
#ghost.speaking .mouth{
  transform-origin:center; transform-box:fill-box;
  animation: talk 150ms ease-in-out infinite;
}
@keyframes talk{ 0%,100%{ transform: scaleY(0.35) } 50%{ transform: scaleY(0.9) } }

/* RGB glitch edge bursts (class toggled in JS) */
#ghost.glitch .sprite{
  filter:
    drop-shadow( 2px -1px rgba(255,32,96,.35))
    drop-shadow(-2px  1px rgba( 32,210,255,.35));
  animation: ghostGlitch 180ms steps(2,end) 1;
}
@keyframes ghostGlitch{
  0%{ transform: translate( .5px, -.5px) skewX(.6deg) }
  50%{ transform: translate(-.5px,  .5px) skewX(-.6deg) }
  100%{ transform: translate(0,0) }
}
/* Evil face swap */
#ghost .face-normal,
#ghost .face-evil {
  transition: opacity 180ms ease;
  opacity: 1;
}
#ghost .face-evil { opacity: 0; }

#ghost.evil .face-normal { opacity: 0; }
#ghost.evil .face-evil   { opacity: 1; }

/* Optional: a slightly meaner tint during evil pulses */
#ghost.glitch-strong .sprite {
  filter: contrast(1.15) saturate(1.1);
}
#ghost.evil .face-evil { opacity: 1 !important; }
/* ===== Mini-ghost face swap (follower/perched/drifter) ===== */
.followerGhost .face-evil,
.perchGhost   .face-evil,
.drifterGhost .face-evil { opacity: 0; transition: opacity .18s ease; }

.followerGhost.evil .face-normal,
.perchGhost.evil   .face-normal,
.drifterGhost.evil .face-normal { opacity: 0; }

.followerGhost.evil .face-evil,
.perchGhost.evil   .face-evil,
.drifterGhost.evil .face-evil { opacity: 1; }

/* keep the tiny “nudge” glitch anim on minis */
.followerGhost.glitch .sprite,
.perchGhost.glitch   .sprite,
.drifterGhost.glitch .sprite { animation: ghostGlitch .16s steps(2,end) 1; }

/* optional word wobble + rgb edge (kept) */
@keyframes wobble{
  0%{transform:translateY(0) rotate(0)}
  20%{transform:translateY(-1px) rotate(-1.2deg)}
  40%{transform:translateY(1px) rotate(1.2deg)}
  60%{transform:translateY(-.5px) rotate(-.8deg)}
  80%{transform:translateY(.5px) rotate(.8deg)}
  100%{transform:translateY(0) rotate(0)}
}
.wobble{ animation:wobble 420ms ease-in-out infinite; }
.wordWrap.rgbWord::before,
.wordWrap.rgbWord::after{
  content: attr(data-word);
  position:absolute; inset:0; pointer-events:none;
  mix-blend-mode:screen;
  opacity:.9; filter: blur(.8px) saturate(1.35);
}
.wordWrap.rgbWord::before{ color:#ff2a6d; transform:translate(6px,-3px) skewX(6deg) }
.wordWrap.rgbWord::after { color:#2ad4ff; transform:translate(-6px,3px)  skewX(-6deg) }




/* ---------- Speech bubble (glass, readable, closer) ---------- */
#ghost .bubble{
  /* layout */
  position: absolute;
  left: 50%;
  top: calc(100% + -50px);             /* closer: was +8px */
  transform: translateX(-50%);
  display: inline-block;

  /* line length (readability sweet spot) */
  --bubble-min: 26ch;                /* never narrower than ~26 characters */
  --bubble-max: 70ch;                /* never wider   than ~42 characters */
  min-inline-size: var(--bubble-min);
  max-inline-size: var(--bubble-max);

  /* look */
  --bg1: rgba(16,22,32,0.94);
  --bg2: rgba(10,14,22,0.92);
  --ring: rgba(255,255,255,0.14);

  background: linear-gradient(180deg, var(--bg1), var(--bg2));
  color: #e8edf8;
  border: 1px solid var(--ring);
  border-radius: 16px;
  padding: 14px 22px;                /* a touch wider */
  text-align: left;
  white-space: pre-wrap;             /* keep your \n */
  overflow-wrap: anywhere;
  text-wrap: balance;                /* nicer wrapping */
  line-height: 1.45;
  font-size: clamp(14px, 1.5vw, 16px);
  letter-spacing: .1px;
  text-shadow: 0 1px 0 rgba(0,0,0,.35);

  /* glass depth */
  backdrop-filter: blur(8px) saturate(120%);
  box-shadow:
    0 10px 28px rgba(0,0,0,.42),
    inset 0 1px 0 rgba(255,255,255,.06);

  /* show/hide */
  opacity: 0;                         /* base hidden */
  transform-origin: 50% -8px;         /* scale from tail */
  transition: opacity .35s ease, transform .35s ease;
  pointer-events: none;
}

/* centered tail with subtle rim */
#ghost .bubble::before,
#ghost .bubble::after{
  content:"";
  position:absolute; left:50%;
  transform: translateX(-50%);
  pointer-events:none;
}
#ghost .bubble::before{
  top:-10px;
  border-left:10px solid transparent;
  border-right:10px solid transparent;
  border-bottom:10px solid rgba(255,255,255,.12); /* rim highlight */
  filter: blur(.3px);
}
#ghost .bubble::after{
  top:-9px;
  border-left:9px solid transparent;
  border-right:9px solid transparent;
  border-bottom:9px solid rgba(16,22,32,.94);     /* fill */
}

/* visibility states */
#ghost .bubble.show{ opacity: 1; transform: translateX(-50%) }
#ghost .bubble.hide{
  opacity: 0;
  transform: translateX(-50%) scale(.985);
}


